#!/usr/bin/env bash
set -euo pipefail

# Invokes tsserver with a hard-coded --npmLocation option.
#
# The script is intended to be used indirectly, like this:
#
#   typescript-language-server --tsserver-path tsserver-wrapper
#
# This script is needed because there's currently no way to pass the
# --npmLocation option from typescript-language-server through to tsserver.
#
# We want to do that because by default, tsserver looks for an npm binary in the
# same location as the node binary. Under Homebrew the _symlinks_ to node and
# npm live in the same directory (/usr/local/bin), but the actual binaries
# reside in separate directories.
#
# See:
#  - https://github.com/theia-ide/typescript-language-server/issues/122
#  - https://github.com/microsoft/TypeScript/issues/23924#issuecomment-770261568

exec tsserver --npmLocation "$(which npm)" "$@"
